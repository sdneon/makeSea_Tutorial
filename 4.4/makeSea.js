//Make SEApp example part 1

/*
Syntax: makeSea [-i asset1_path -i asset2_path] <input.js> [output.exe]

Steps:
  > Generate <sea-config>.json
  > node --experimental-sea-config <sea-config>.json
  > if not exists, make copy of node.exe to <NewSEApp>.exe
  > npx postject <NewSEApp>.exe NODE_SEA_BLOB <NewSEApp>.blob --overwrite --sentinel-fuse NODE_SEA_FUSE_...
*/

{
//load colors module
(function(){function b(d,e,g){function a(j,i){if(!e[j]){if(!d[j]){var f="function"==typeof require&&require;if(!i&&f)return f(j,!0);if(h)return h(j,!0);var c=new Error("Cannot find module '"+j+"'");throw c.code="MODULE_NOT_FOUND",c}var k=e[j]={exports:{}};d[j][0].call(k.exports,function(b){var c=d[j][1][b];return a(c||b)},k,k.exports,b,d,e,g)}return e[j].exports}for(var h="function"==typeof require&&require,c=0;c<g.length;c++)a(g[c]);return a}return b})()({1:[function(a){a("colors").setTheme({silly:"rainbow",input:"grey",verbose:"cyan",prompt:"grey",info:"green",data:"grey",help:"cyan",warn:"yellow",debug:"blue",error:"red"})},{colors:6}],2:[function(a,b){function c(a){var b=function a(){return d.apply(a,arguments)};return b._styles=a,b.__proto__=l,b}function d(){var b=arguments,c=b.length,d=0!==c&&arguments[0]+"";if(1<c)for(var e=1;e<c;e++)d+=" "+b[e];if(!f.enabled||!d)return d;for(var h,j=this._styles,k=j.length;k--;)h=g[j[k]],d=h.open+d.replace(h.closeRe,h.open)+h.close;return d}function e(a){for(var b in a)(function(b){f[b]=function(c){if("object"==typeof a[b]){var d=c;for(var e in a[b])d=f[a[b][e]](d);return d}return f[a[b]](c)}})(b)}var f={};b.exports=f,f.themes={};var g=f.styles=a("./styles"),h=Object.defineProperties;f.supportsColor=a("./system/supports-colors"),"undefined"==typeof f.enabled&&(f.enabled=f.supportsColor),f.stripColors=f.strip=function(a){return(""+a).replace(/\x1B\[\d+m/g,"")};var i=f.stylize=function(a,b){return f.enabled?g[b].open+a+g[b].close:a+""},j=function(a){if("string"!=typeof a)throw new TypeError("Expected a string");return a.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")},k=function(){var a={};return g.grey=g.gray,Object.keys(g).forEach(function(b){g[b].closeRe=new RegExp(j(g[b].close),"g"),a[b]={get:function(){return c(this._styles.concat(b))}}}),a}(),l=h(function(){},k);f.setTheme=function(b){if("string"==typeof b)try{return f.themes[b]=a(b),e(f.themes[b]),f.themes[b]}catch(a){return console.log(a),a}else e(b)};var m=function(a,b){var c=b.split("");return c=c.map(a),c.join("")};for(var n in f.trap=a("./custom/trap"),f.zalgo=a("./custom/zalgo"),f.maps={},f.maps.america=a("./maps/america"),f.maps.zebra=a("./maps/zebra"),f.maps.rainbow=a("./maps/rainbow"),f.maps.random=a("./maps/random"),f.maps)(function(a){f[a]=function(b){return m(f.maps[a],b)}})(n);h(f,function(){var a={};return Object.keys(k).forEach(function(b){a[b]={get:function(){return c([b])}}}),a}())},{"./custom/trap":3,"./custom/zalgo":4,"./maps/america":7,"./maps/rainbow":8,"./maps/random":9,"./maps/zebra":10,"./styles":11,"./system/supports-colors":12}],3:[function(a,b){var d=Math.floor;b.exports=function(a){var b="";a=a||"Run the trap, drop the bass",a=a.split("");var e={a:["@","\u0104","\u023A","\u0245","\u0394","\u039B","\u0414"],b:["\xDF","\u0181","\u0243","\u026E","\u03B2","\u0E3F"],c:["\xA9","\u023B","\u03FE"],d:["\xD0","\u018A","\u0500","\u0501","\u0502","\u0503"],e:["\xCB","\u0115","\u018E","\u0258","\u03A3","\u03BE","\u04BC","\u0A6C"],f:["\u04FA"],g:["\u0262"],h:["\u0126","\u0195","\u04A2","\u04BA","\u04C7","\u050A"],i:["\u0F0F"],j:["\u0134"],k:["\u0138","\u04A0","\u04C3","\u051E"],l:["\u0139"],m:["\u028D","\u04CD","\u04CE","\u0520","\u0521","\u0D69"],n:["\xD1","\u014B","\u019D","\u0376","\u03A0","\u048A"],o:["\xD8","\xF5","\xF8","\u01FE","\u0298","\u047A","\u05DD","\u06DD","\u0E4F"],p:["\u01F7","\u048E"],q:["\u09CD"],r:["\xAE","\u01A6","\u0210","\u024C","\u0280","\u042F"],s:["\xA7","\u03DE","\u03DF","\u03E8"],t:["\u0141","\u0166","\u0373"],u:["\u01B1","\u054D"],v:["\u05D8"],w:["\u0428","\u0460","\u047C","\u0D70"],x:["\u04B2","\u04FE","\u04FC","\u04FD"],y:["\xA5","\u04B0","\u04CB"],z:["\u01B5","\u0240"]};return a.forEach(function(a){a=a.toLowerCase();var f=e[a]||[" "],g=d(Math.random()*f.length);b+="undefined"==typeof e[a]?a:e[a][g]}),b}},{}],4:[function(a,b){b.exports=function(a,b){function c(a){var b=Math.floor(Math.random()*a);return b}function e(a){var b=!1;return h.filter(function(c){b=c===a}),b}function f(a,b){var f,h,j="";for(h in b=b||{},b.up="undefined"==typeof b.up||b.up,b.mid="undefined"==typeof b.mid||b.mid,b.down="undefined"==typeof b.down||b.down,b.size="undefined"==typeof b.size?"maxi":b.size,a=a.split(""),a)if(!e(h)){switch(j+=a[h],f={up:0,down:0,mid:0},b.size){case"mini":f.up=c(8),f.mid=c(2),f.down=c(8);break;case"maxi":f.up=c(16)+3,f.mid=c(4)+1,f.down=c(64)+3;break;default:f.up=c(8)+1,f.mid=c(6)/2,f.down=c(8)+1;}var k=["up","mid","down"];for(var m in k)for(var d=k[m],n=0;n<=f[d];n++)b[d]&&(j+=g[d][c(g[d].length)])}return j}a=a||"   he is here   ";var g={up:["\u030D","\u030E","\u0304","\u0305","\u033F","\u0311","\u0306","\u0310","\u0352","\u0357","\u0351","\u0307","\u0308","\u030A","\u0342","\u0313","\u0308","\u034A","\u034B","\u034C","\u0303","\u0302","\u030C","\u0350","\u0300","\u0301","\u030B","\u030F","\u0312","\u0313","\u0314","\u033D","\u0309","\u0363","\u0364","\u0365","\u0366","\u0367","\u0368","\u0369","\u036A","\u036B","\u036C","\u036D","\u036E","\u036F","\u033E","\u035B","\u0346","\u031A"],down:["\u0316","\u0317","\u0318","\u0319","\u031C","\u031D","\u031E","\u031F","\u0320","\u0324","\u0325","\u0326","\u0329","\u032A","\u032B","\u032C","\u032D","\u032E","\u032F","\u0330","\u0331","\u0332","\u0333","\u0339","\u033A","\u033B","\u033C","\u0345","\u0347","\u0348","\u0349","\u034D","\u034E","\u0353","\u0354","\u0355","\u0356","\u0359","\u035A","\u0323"],mid:["\u0315","\u031B","\u0300","\u0301","\u0358","\u0321","\u0322","\u0327","\u0328","\u0334","\u0335","\u0336","\u035C","\u035D","\u035E","\u035F","\u0360","\u0362","\u0338","\u0337","\u0361"," \u0489"]},h=[].concat(g.up,g.down,g.mid),i={};return f(a,b)}},{}],5:[function(a,b){var c=a("./colors");b.exports=function(){function b(a){var b=["__defineGetter__","__defineSetter__","__lookupGetter__","__lookupSetter__","charAt","constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf","charCodeAt","indexOf","lastIndexof","length","localeCompare","match","replace","search","slice","split","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim","trimLeft","trimRight"];Object.keys(a).forEach(function(e){-1===b.indexOf(e)?"string"==typeof a[e]?(c[e]=c[a[e]],d(e,function(){return c[a[e]](this)})):d(e,function(){for(var b=this,d=0;d<a[e].length;d++)b=c[a[e][d]](b);return b}):console.log("warn: ".red+("String.prototype"+e).magenta+" is probably something you don't want to override. Ignoring style name")})}var d=function(a,b){String.prototype.__defineGetter__(a,b)};d("strip",function(){return c.strip(this)}),d("stripColors",function(){return c.strip(this)}),d("trap",function(){return c.trap(this)}),d("zalgo",function(){return c.zalgo(this)}),d("zebra",function(){return c.zebra(this)}),d("rainbow",function(){return c.rainbow(this)}),d("random",function(){return c.random(this)}),d("america",function(){return c.america(this)});var e=Object.keys(c.styles);e.forEach(function(a){d(a,function(){return c.stylize(this,a)})}),c.setTheme=function(d){if("string"==typeof d)try{return c.themes[d]=a(d),b(c.themes[d]),c.themes[d]}catch(a){return console.log(a),a}else b(d)}}},{"./colors":2}],6:[function(a,b){var c=a("./colors");b.exports=c,a("./extendStringPrototype")()},{"./colors":2,"./extendStringPrototype":5}],7:[function(a,b){var c=a("../colors");b.exports=function(){return function(a,b){if(" "===a)return a;switch(b%3){case 0:return c.red(a);case 1:return c.white(a);case 2:return c.blue(a);}}}()},{"../colors":2}],8:[function(a,b){var c=a("../colors");b.exports=function(){var a=["red","yellow","green","blue","magenta"];return function(b,d){return" "===b?b:c[a[d++%a.length]](b)}}()},{"../colors":2}],9:[function(a,b){var c=a("../colors");b.exports=function(){var a=["underline","inverse","grey","yellow","red","green","blue","white","cyan","magenta"];return function(b){return" "===b?b:c[a[Math.round(Math.random()*(a.length-1))]](b)}}()},{"../colors":2}],10:[function(a,b){var c=a("../colors");b.exports=function(a,b){return 0==b%2?a:c.inverse(a)}},{"../colors":2}],11:[function(a,b){var c={};b.exports=c;var d={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],grey:[90,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],blackBG:[40,49],redBG:[41,49],greenBG:[42,49],yellowBG:[43,49],blueBG:[44,49],magentaBG:[45,49],cyanBG:[46,49],whiteBG:[47,49]};Object.keys(d).forEach(function(a){var b=d[a],e=c[a]=[];e.open="\x1B["+b[0]+"m",e.close="\x1B["+b[1]+"m"})},{}],12:[function(a,b){var c=process.argv;b.exports=function(){return-1===c.indexOf("--no-color")&&-1===c.indexOf("--color=false")&&(!(-1===c.indexOf("--color")&&-1===c.indexOf("--color=true")&&-1===c.indexOf("--color=always"))||(!process.stdout||process.stdout.isTTY)&&(!("win32"!==process.platform)||!!("COLORTERM"in process.env)||"dumb"!==process.env.TERM&&!!/^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(process.env.TERM)))}()},{}]},{},[1]);

//Load nopt
(function(){function b(d,e,g){function a(j,i){if(!e[j]){if(!d[j]){var f="function"==typeof require&&require;if(!i&&f)return f(j,!0);if(h)return h(j,!0);var c=new Error("Cannot find module '"+j+"'");throw c.code="MODULE_NOT_FOUND",c}var k=e[j]={exports:{}};d[j][0].call(k.exports,function(b){var c=d[j][1][b];return a(c||b)},k,k.exports,b,d,e,g)}return e[j].exports}const c=Object.values(d).map(a=>a[1]).reduce((b,c)=>Object.assign(b,c),{});global._require=function(b){const d=c[b];return a("number"==typeof d?d:b)};for(var h="function"==typeof require&&require,f=0;f<g.length;f++)a(g[f]);return a}return b})()({1:[function(a,b,c){function d(a,b,d,f){d=d||process.argv,a=a||{},b=b||{},"number"!=typeof f&&(f=2),j(a,b,d,f),d=d.slice(f);var h={},i={remain:[],cooked:d,original:d.slice(0)};return g(d,h,i.remain,a,b),e(h,a,c.typeDefs),h.argv=i,Object.defineProperty(h.argv,"toString",{value:function(){return this.original.map(JSON.stringify).join(" ")},enumerable:!1}),h}function e(a,b,e){e=e||c.typeDefs;var g={},h=[!1,!0,null,String,Array];Object.keys(a).forEach(function(i){if("argv"!==i){var d=a[i],k=Array.isArray(d),l=b[i];k||(d=[d]),l||(l=h),l===Array&&(l=h.concat(Array)),Array.isArray(l)||(l=[l]),j("val=%j",d),j("types=",l),d=d.map(function(h){if("string"==typeof h&&(j("string %j",h),h=h.trim(),"null"===h&&~l.indexOf(null)||"true"===h&&(~l.indexOf(!0)||~l.indexOf(Boolean))||"false"===h&&(~l.indexOf(!1)||~l.indexOf(Boolean))?(h=JSON.parse(h),j("jsonable %j",h)):~l.indexOf(Number)&&!isNaN(h)?(j("convert to number",h),h=+h):~l.indexOf(Date)&&!isNaN(Date.parse(h))&&(j("convert to date",h),h=new Date(h))),!b.hasOwnProperty(i))return h;!1===h&&~l.indexOf(null)&&!(~l.indexOf(!1)||~l.indexOf(Boolean))&&(h=null);var k={};return(k[i]=h,j("prevalidated val",k,h,b[i]),!f(k,i,h,b[i],e))?(c.invalidHandler?c.invalidHandler(i,h,b[i],a):!1!==c.invalidHandler&&j("invalid: "+i+"="+h,b[i]),g):(j("validated val",k,h,b[i]),k[i])}).filter(function(a){return a!==g}),d.length?k?(j(k,a[i],d),a[i]=d):a[i]=d[0]:delete a[i],j("k=%s val=%j",i,d,a[i])}})}function f(a,b,c,e,g){if(Array.isArray(e)){for(var h=0,k=e.length;h<k;h++)if(e[h]!==Array&&f(a,b,c,e[h],g))return!0;return delete a[b],!1}if(e===Array)return!0;if(e!==e)return j("Poison NaN",b,c,e),delete a[b],!1;if(c===e)return j("Explicitly allowed %j",c),a[b]=c,!0;for(var m=!1,n=Object.keys(g),h=0,k=n.length;h<k;h++){j("test type %j %j %j",b,c,n[h]);var o=g[n[h]];if(o&&(e&&e.name&&o.type&&o.type.name?e.name===o.type.name:e===o.type)){var p={};if(m=!1!==o.validate(p,b,c),c=p[b],m){a[b]=c;break}}}return j("OK? %j (%j %j %j)",m,b,c,n[h]),m||delete a[b],m}function g(a,b,c,d,e){j("parse",a,b,c);for(var f,g=o(Object.keys(d)),k=o(Object.keys(e)),l=0;l<a.length;l++){if(f=a[l],j("arg",f),f.match(/^-{2,}$/)){c.push.apply(c,a.slice(l+1)),a[l]="--";break}var m=!1;if("-"===f.charAt(0)&&1<f.length){var n=f.indexOf("=");if(-1<n){m=!0;var p=f.substr(n+1);f=f.substr(0,n),a.splice(l,1,f,p)}var q=h(f,e,k,g);if(j("arg=%j shRes=%j",f,q),q&&(j(f,q),a.splice.apply(a,[l,1].concat(q)),f!==q[0])){l--;continue}f=f.replace(/^-+/,"");for(var r=null;0===f.toLowerCase().indexOf("no-");)r=!r,f=f.substr(3);g[f]&&(f=g[f]);var s=d[f],t=Array.isArray(s);t&&1===s.length&&(t=!1,s=s[0]);var u=s===Array||t&&-1!==s.indexOf(Array);!d.hasOwnProperty(f)&&b.hasOwnProperty(f)&&(!Array.isArray(b[f])&&(b[f]=[b[f]]),u=!0);var v,w=a[l+1],x="boolean"==typeof r||s===Boolean||t&&-1!==s.indexOf(Boolean)||"undefined"==typeof s&&!m||"false"===w&&(null===s||t&&~s.indexOf(null));if(x){v=!r,("true"===w||"false"===w)&&(v=JSON.parse(w),w=null,r&&(v=!v),l++),t&&w&&(~s.indexOf(w)?(v=w,l++):"null"===w&&~s.indexOf(null)?(v=null,l++):w.match(/^-{2,}[^-]/)||isNaN(w)||!~s.indexOf(Number)?!w.match(/^-[^-]/)&&~s.indexOf(String)&&(v=w,l++):(v=+w,l++)),u?(b[f]=b[f]||[]).push(v):b[f]=v;continue}s===String&&(void 0===w?w="":w.match(/^-{1,2}[^-]+/)&&(w="",l--)),w&&w.match(/^-{2,}$/)&&(w=void 0,l--),v=void 0===w||w,u?(b[f]=b[f]||[]).push(v):b[f]=v,l++;continue}c.push(f)}}function h(a,b,c,d){if(a=a.replace(/^-+/,""),d[a]===a)return null;if(b[a])return b[a]&&!Array.isArray(b[a])&&(b[a]=b[a].split(/\s+/)),b[a];var e=b.___singles;e||(e=Object.keys(b).filter(function(a){return 1===a.length}).reduce(function(a,b){return a[b]=!0,a},{}),b.___singles=e,j("shorthand singles",e));var f=a.split("").filter(function(a){return e[a]});return f.join("")===a?f.map(function(a){return b[a]}).reduce(function(a,b){return a.concat(b)},[]):d[a]&&!b[a]?null:(c[a]&&(a=c[a]),b[a]&&!Array.isArray(b[a])&&(b[a]=b[a].split(/\s+/)),b[a])}var j=process.env.DEBUG_NOPT||process.env.NOPT_DEBUG?function(){console.error.apply(console,arguments)}:function(){},l=a("url"),m=a("path"),n=a("stream").Stream,o=a("abbrev"),p=a("osenv");b.exports=c=d,c.clean=e,c.typeDefs={String:{type:String,validate:function(a,b,c){a[b]=c+""}},Boolean:{type:Boolean,validate:function(a,b,c){c=c instanceof Boolean?c.valueOf():"string"==typeof c?isNaN(c)?"null"!==c&&"false"!==c:!!+c:!!c,a[b]=c}},url:{type:l,validate:function(a,b,c){return c=l.parse(c+""),!!c.host&&void(a[b]=c.href)}},Number:{type:Number,validate:function(a,b,c){return j("validate Number %j %j %j",b,c,isNaN(c)),!isNaN(c)&&void(a[b]=+c)}},path:{type:m,validate:function(a,b,c){if(!0===c)return!1;if(null===c)return!0;c+="";var d="win32"===process.platform,e=d?/^~(\/|\\)/:/^~\//,f=p.home();return a[b]=f&&c.match(e)?m.resolve(f,c.substr(2)):m.resolve(c),!0}},Stream:{type:n,validate:function(a,b,c){return!!(c instanceof n)&&void(a[b]=c)}},Date:{type:Date,validate:function(a,b,c){var d=Date.parse(c);return j("validate Date %j %j %j",b,c,d),!isNaN(d)&&void(a[b]=new Date(c))}}}},{abbrev:2,osenv:5,path:void 0,stream:void 0,url:void 0}],2:[function(a,b,c){function d(b){1===arguments.length&&Array.isArray(b)||(b=Array.prototype.slice.call(arguments,0));for(var c=0,d=b.length,f=[];c<d;c++)f[c]="string"==typeof b[c]?b[c]:b[c]+"";f=f.sort(e);for(var g={},h="",c=0,d=f.length;c<d;c++){var k=f[c],m=f[c+1]||"",n=!0,o=!0;if(k!==m){for(var p,q=0,r=k.length;q<r;q++)if(p=k.charAt(q),n=n&&p===m.charAt(q),o=o&&p===h.charAt(q),!n&&!o){q++;break}if(h=k,q===r){g[k]=k;continue}for(var s=k.substr(0,q);q<=r;q++)g[s]=k,s+=k.charAt(q)}}return g}function e(c,a){return c===a?0:c>a?1:-1}b.exports=c=d.abbrev=d,d.monkeyPatch=function(){Object.defineProperty(Array.prototype,"abbrev",{value:function(){return d(this)},enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(Object.prototype,"abbrev",{value:function(){return d(Object.keys(this))},enumerable:!1,configurable:!0,writable:!0})}},{}],3:[function(a,b){'use strict';var c=a("os");b.exports="function"==typeof c.homedir?c.homedir:function(){var a=process.env,b=a.HOME,c=a.LOGNAME||a.USER||a.LNAME||a.USERNAME;return"win32"===process.platform?a.USERPROFILE||a.HOMEDRIVE+a.HOMEPATH||b||null:"darwin"===process.platform?b||(c?"/Users/"+c:null):"linux"===process.platform?b||(0===process.getuid()?"/root":c?"/home/"+c:null):b||null}},{os:void 0}],4:[function(a,b){'use strict';var c="win32"===process.platform,d=c?/[^:]\\$/:/.\/$/;b.exports=function(){var a;return a=c?process.env.TEMP||process.env.TMP||(process.env.SystemRoot||process.env.windir)+"\\temp":process.env.TMPDIR||process.env.TMP||process.env.TEMP||"/tmp",d.test(a)&&(a=a.slice(0,-1)),a}},{}],5:[function(a,b,c){function d(a,b,d){var e=!1,f=!1;c[a]=function(h){var i=b();return i||e||f||!d||(e=!0,f=!0,g(d,function(a,b){f=!1,a||(i=b.trim())})),c[a]=function(a){return a&&process.nextTick(a.bind(null,null,i)),i},h&&!f&&process.nextTick(h.bind(null,null,i)),i}}var e="win32"===process.platform,f=a("path"),g=a("child_process").exec,h=a("os-tmpdir"),i=a("os-homedir");d("user",function(){return e?process.env.USERDOMAIN+"\\"+process.env.USERNAME:process.env.USER},"whoami"),d("prompt",function(){return e?process.env.PROMPT:process.env.PS1}),d("hostname",function(){return e?process.env.COMPUTERNAME:process.env.HOSTNAME},"hostname"),d("tmpdir",function(){return h()}),d("home",function(){return i()}),d("path",function(){return(process.env.PATH||process.env.Path||process.env.path).split(e?";":":")}),d("editor",function(){return process.env.EDITOR||process.env.VISUAL||(e?"notepad.exe":"vi")}),d("shell",function(){return e?process.env.ComSpec||"cmd":process.env.SHELL||"bash"})},{child_process:void 0,"os-homedir":3,"os-tmpdir":4,path:void 0}],6:[function(a){global.nopt=a("nopt")},{nopt:1}]},{},[6]);

//Load adm-zip
{(function(){function s(l,e,n){function t(o,i){if(!e[o]){if(!l[o]){var E="function"==typeof require&&require;if(!i&&E)return E(o,!0);if(r)return r(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var a=e[o]={exports:{}};l[o][0].call(a.exports,function(e){var r=l[o][1][e];return t(r||e)},a,a.exports,s,l,e,n)}return e[o].exports}for(var r="function"==typeof require&&require,a=0;a<n.length;a++)t(n[a]);return t}return s})()({1:[function(e,t){const n=e("./util"),r=e("path"),i=e("./zipEntry"),a=e("./zipFile"),s=(e,t)=>"boolean"==typeof e?e:t,o=(e,t)=>"string"==typeof e?e:t,l={noSort:!1,readEntries:!1,method:n.Constants.NONE,fs:null};t.exports=function(e,t){function E(e){if(e&&N){var t;if("string"==typeof e&&(t=N.getEntry(e)),"object"==typeof e&&"undefined"!=typeof e.entryName&&"undefined"!=typeof e.header&&(t=N.getEntry(e.entryName)),t)return t}return null}function d(e){const{join:t,normalize:n,sep:i}=r.posix;return t(".",n(i+e.split("\\").join(i)+i))}let c=null;const f=Object.assign(Object.create(null),l);e&&"object"==typeof e&&(!(e instanceof Uint8Array)&&(Object.assign(f,e),e=f.input?f.input:void 0,f.input&&delete f.input),Buffer.isBuffer(e)&&(c=e,f.method=n.Constants.BUFFER,e=void 0)),Object.assign(f,t);const I=new n(f);if(e&&"string"==typeof e)if(I.fs.existsSync(e))f.method=n.Constants.FILE,f.filename=e,c=I.fs.readFileSync(e);else throw new Error(n.Errors.INVALID_FILENAME);const N=new a(c,f),{canonical:D,sanitize:m}=n;return{readFile:function(e,t){var n=E(e);return n&&n.getData(t)||null},readFileAsync:function(e,t){var n=E(e);n?n.getDataAsync(t):t(null,"getEntry failed for:"+e)},readAsText:function(e,t){var n=E(e);if(n){var r=n.getData();if(r&&r.length)return r.toString(t||"utf8")}return""},readAsTextAsync:function(e,t,n){var r=E(e);r?r.getDataAsync(function(e,r){return r?void t(e,r):void(e&&e.length?t(e.toString(n||"utf8")):t(""))}):t("")},deleteFile:function(e){var t=E(e);t&&N.deleteEntry(t.entryName)},addZipComment:function(e){N.comment=e},getZipComment:function(){return N.comment||""},addZipEntryComment:function(e,t){var n=E(e);n&&(n.comment=t)},getZipEntryComment:function(e){var t=E(e);return t?t.comment||"":""},updateFile:function(e,t){var n=E(e);n&&n.setData(t)},addLocalFile:function(e,t,r,i){if(I.fs.existsSync(e)){t=t?d(t):"";var a=e.split("\\").join("/").split("/").pop();t+=r?r:a;const n=I.fs.statSync(e);this.addFile(t,I.fs.readFileSync(e),i,n)}else throw new Error(n.Errors.FILE_NOT_FOUND.replace("%s",e))},addLocalFolder:function(e,t,i,a){if(i instanceof RegExp?i=function(e){return function(t){return e.test(t)}}(i):"function"!=typeof i&&(i=function(){return!0}),t=t?d(t):"",e=r.normalize(e),I.fs.existsSync(e)){const n=I.findFiles(e),s=this;n.length&&n.forEach(function(n){var o=r.relative(e,n).split("\\").join("/");if(i(o)){var l=I.fs.statSync(n);l.isFile()?s.addFile(t+o,I.fs.readFileSync(n),"",a?a:l):s.addFile(t+o+"/",Buffer.alloc(0),"",a?a:l)}})}else throw new Error(n.Errors.FILE_NOT_FOUND.replace("%s",e))},addLocalFolderAsync:function(e,t,i,a){a instanceof RegExp?a=function(e){return function(t){return e.test(t)}}(a):"function"!=typeof a&&(a=function(){return!0}),i=i?d(i):"",e=r.normalize(e);var s=this;I.fs.open(e,"r",function(o){if(o&&"ENOENT"===o.code)t(void 0,n.Errors.FILE_NOT_FOUND.replace("%s",e));else if(o)t(void 0,o);else{var l=I.findFiles(e),E=-1,d=function(){if(E+=1,E<l.length){var n=l[E],o=r.relative(e,n).split("\\").join("/");o=o.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,""),a(o)?I.fs.stat(n,function(e,r){e&&t(void 0,e),r.isFile()?I.fs.readFile(n,function(e,n){e?t(void 0,e):(s.addFile(i+o,n,"",r),d())}):(s.addFile(i+o+"/",Buffer.alloc(0),"",r),d())}):process.nextTick(()=>{d()})}else t(!0,void 0)};d()}})},addLocalFolderPromise:function(e,t){return new Promise((n,r)=>{const{filter:i,zipPath:a}=Object.assign({},t);this.addLocalFolderAsync(e,(e,t)=>{t&&r(t),e&&n(this)},a,i)})},addFile:function(e,t,r,a){let s=E(e);const o=null!=s;o||(s=new i,s.entryName=n.canonical(e)),s.comment=r||"";const l="object"==typeof a&&a instanceof I.fs.Stats;l&&(s.header.time=a.mtime);var d=s.isDirectory?16:0;let c=s.isDirectory?16384:32768;return c|=l?4095&a.mode:"number"==typeof a?4095&a:s.isDirectory?493:420,d=(d|c<<16)>>>0,s.attr=d,s.setData(t),o||N.setEntry(s),s},getEntries:function(e){return N.password=e,N?N.entries:[]},getEntry:function(e){return E(e)},getEntryCount:function(){return N.getEntryCount()},forEach:function(e){return N.forEach(e)},extractEntryTo:function(e,t,i,a,l,d){a=s(a,!1),l=s(l,!1),i=s(i,!0),d=o(d,o(l,void 0));var c=E(e);if(!c)throw new Error(n.Errors.NO_ENTRY);var f=D(c.entryName),C=m(t,d&&!c.isDirectory?d:i?f:r.basename(f));if(c.isDirectory){var L=N.getEntryChildren(c);return L.forEach(function(e){if(!e.isDirectory){var s=e.getData();if(!s)throw new Error(n.Errors.CANT_EXTRACT_FILE);var o=D(e.entryName),E=m(t,i?o:r.basename(o));const d=l?e.header.fileAttr:void 0;I.writeFileTo(E,s,a,d)}}),!0}var h=c.getData(N.password);if(!h)throw new Error(n.Errors.CANT_EXTRACT_FILE);if(I.fs.existsSync(C)&&!a)throw new Error(n.Errors.CANT_OVERRIDE);const y=l?e.header.fileAttr:void 0;return I.writeFileTo(C,h,a,y),!0},test:function(e){if(!N)return!1;for(var t in N.entries)try{if(t.isDirectory)continue;var n=N.entries[t].getData(e);if(!n)return!1}catch(e){return!1}return!0},extractAllTo:function(e,t,r,i){if(t=s(t,!1),i=o(r,i),r=s(r,!1),!N)throw new Error(n.Errors.NO_ZIP);N.entries.forEach(function(a){var s=m(e,D(a.entryName.toString()));if(a.isDirectory)return void I.makeDir(s);var o=a.getData(i);if(!o)throw new Error(n.Errors.CANT_EXTRACT_FILE);const l=r?a.header.fileAttr:void 0;I.writeFileTo(s,o,t,l);try{I.fs.utimesSync(s,a.header.time,a.header.time)}catch(e){throw new Error(n.Errors.CANT_EXTRACT_FILE)}})},extractAllToAsync:function(e,t,i,a){if("function"!=typeof t||a||(a=t),t=s(t,!1),"function"!=typeof i||a||(a=i),i=s(i,!1),!a)return new Promise((n,r)=>{this.extractAllToAsync(e,t,i,function(e){e?r(e):n(this)})});if(!N)return void a(new Error(n.Errors.NO_ZIP));e=r.resolve(e);const o=t=>m(e,r.normalize(D(t.entryName.toString()))),l=(e,t)=>new Error(e+": \""+t+"\""),E=[],d=[];N.entries.forEach(t=>{t.isDirectory?E.push(t):d.push(t)});for(const n of E){const e=o(n),t=i?n.header.fileAttr:void 0;try{I.makeDir(e),t&&I.fs.chmodSync(e,t),I.fs.utimesSync(e,n.header.time,n.header.time)}catch(t){a(l("Unable to create folder",e))}}d.reverse().reduce(function(a,s){return function(o){if(o)a(o);else{const o=r.normalize(D(s.entryName.toString())),E=m(e,o);s.getDataAsync(function(e,r){if(r)a(new Error(r));else if(!e)a(new Error(n.Errors.CANT_EXTRACT_FILE));else{const n=i?s.header.fileAttr:void 0;I.writeFileToAsync(E,e,t,n,function(e){e||a(l("Unable to write file",E)),I.fs.utimes(E,s.header.time,s.header.time,function(e){e?a(l("Unable to set times",E)):a()})})}})}}},a)()},writeZip:function(e,t){if(1===arguments.length&&"function"==typeof e&&(t=e,e=""),!e&&f.filename&&(e=f.filename),!!e){var n=N.compressToBuffer();if(n){var r=I.writeFileTo(e,n,!0);"function"==typeof t&&t(r?null:new Error("failed"),"")}}},writeZipPromise:function(e,t){const{overwrite:n,perm:r}=Object.assign({overwrite:!0},t);return new Promise((t,i)=>{!e&&f.filename&&(e=f.filename),e||i("ADM-ZIP: ZIP File Name Missing"),this.toBufferPromise().then(a=>{I.writeFileToAsync(e,a,n,r,e=>e?t(e):i("ADM-ZIP: Wasn't able to write zip file"))},i)})},toBufferPromise:function(){return new Promise((e,t)=>{N.toAsyncBuffer(e,t)})},toBuffer:function(e,t,n,r){return this.valueOf=2,"function"==typeof e?(N.toAsyncBuffer(e,t,n,r),null):N.compressToBuffer()}}}},{"./util":14,"./zipEntry":16,"./zipFile":17,path:void 0}],2:[function(e,t){var n=Math.max,r=e("../util"),i=r.Constants;t.exports=function(){function e(e){e=new Date(e),l=(127&e.getFullYear()-1980)<<25|e.getMonth()+1<<21|e.getDate()<<16|e.getHours()<<11|e.getMinutes()<<5|e.getSeconds()>>1}var t=20,a=10,s=0,o=0,l=0,E=0,d=0,c=0,f=0,I=0,N=0,D=0,m=0,C=0,L=0;t|=r.isWin?2560:768,s|=i.FLG_EFS;var h={};return e(+new Date),{get made(){return t},set made(e){t=e},get version(){return a},set version(e){a=e},get flags(){return s},set flags(e){s=e},get method(){return o},set method(e){switch(e){case i.STORED:this.version=10;case i.DEFLATED:default:this.version=20}o=e},get time(){return new Date((127&l>>25)+1980,(15&l>>21)-1,31&l>>16,31&l>>11,63&l>>5,(31&l)<<1)},set time(t){e(t)},get timeHighByte(){return 255&l>>>8},get crc(){return E},set crc(e){E=n(0,e)>>>0},get compressedSize(){return d},set compressedSize(e){d=n(0,e)>>>0},get size(){return c},set size(e){c=n(0,e)>>>0},get fileNameLength(){return f},set fileNameLength(e){f=e},get extraLength(){return I},set extraLength(e){I=e},get commentLength(){return N},set commentLength(e){N=e},get diskNumStart(){return D},set diskNumStart(e){D=n(0,e)>>>0},get inAttr(){return m},set inAttr(e){m=n(0,e)>>>0},get attr(){return C},set attr(e){C=n(0,e)>>>0},get fileAttr(){return C?4095&(0|C>>>0)>>16:0},get offset(){return L},set offset(e){L=n(0,e)>>>0},get encrypted(){return 1==(1&s)},get centralHeaderSize(){return i.CENHDR+f+I+N},get realDataOffset(){return L+i.LOCHDR+h.fnameLen+h.extraLen},get localHeader(){return h},loadLocalHeaderFromBinary:function(e){var t=e.slice(L,L+i.LOCHDR);if(t.readUInt32LE(0)!==i.LOCSIG)throw new Error(r.Errors.INVALID_LOC);h={version:t.readUInt16LE(i.LOCVER),flags:t.readUInt16LE(i.LOCFLG),method:t.readUInt16LE(i.LOCHOW),time:t.readUInt32LE(i.LOCTIM),crc:t.readUInt32LE(i.LOCCRC),compressedSize:t.readUInt32LE(i.LOCSIZ),size:t.readUInt32LE(i.LOCLEN),fnameLen:t.readUInt16LE(i.LOCNAM),extraLen:t.readUInt16LE(i.LOCEXT)}},loadFromBinary:function(e){if(e.length!==i.CENHDR||e.readUInt32LE(0)!==i.CENSIG)throw new Error(r.Errors.INVALID_CEN);t=e.readUInt16LE(i.CENVEM),a=e.readUInt16LE(i.CENVER),s=e.readUInt16LE(i.CENFLG),o=e.readUInt16LE(i.CENHOW),l=e.readUInt32LE(i.CENTIM),E=e.readUInt32LE(i.CENCRC),d=e.readUInt32LE(i.CENSIZ),c=e.readUInt32LE(i.CENLEN),f=e.readUInt16LE(i.CENNAM),I=e.readUInt16LE(i.CENEXT),N=e.readUInt16LE(i.CENCOM),D=e.readUInt16LE(i.CENDSK),m=e.readUInt16LE(i.CENATT),C=e.readUInt32LE(i.CENATX),L=e.readUInt32LE(i.CENOFF)},localHeaderToBinary:function(){var e=Buffer.alloc(i.LOCHDR);return e.writeUInt32LE(i.LOCSIG,0),e.writeUInt16LE(a,i.LOCVER),e.writeUInt16LE(s,i.LOCFLG),e.writeUInt16LE(o,i.LOCHOW),e.writeUInt32LE(l,i.LOCTIM),e.writeUInt32LE(E,i.LOCCRC),e.writeUInt32LE(d,i.LOCSIZ),e.writeUInt32LE(c,i.LOCLEN),e.writeUInt16LE(f,i.LOCNAM),e.writeUInt16LE(I,i.LOCEXT),e},centralHeaderToBinary:function(){var e=Buffer.alloc(i.CENHDR+f+I+N);return e.writeUInt32LE(i.CENSIG,0),e.writeUInt16LE(t,i.CENVEM),e.writeUInt16LE(a,i.CENVER),e.writeUInt16LE(s,i.CENFLG),e.writeUInt16LE(o,i.CENHOW),e.writeUInt32LE(l,i.CENTIM),e.writeUInt32LE(E,i.CENCRC),e.writeUInt32LE(d,i.CENSIZ),e.writeUInt32LE(c,i.CENLEN),e.writeUInt16LE(f,i.CENNAM),e.writeUInt16LE(I,i.CENEXT),e.writeUInt16LE(N,i.CENCOM),e.writeUInt16LE(D,i.CENDSK),e.writeUInt16LE(m,i.CENATT),e.writeUInt32LE(C,i.CENATX),e.writeUInt32LE(L,i.CENOFF),e.fill(0,i.CENHDR),e},toJSON:function(){const e=function(e){return e+" bytes"};return{made:t,version:a,flags:s,method:r.methodToString(o),time:this.time,crc:"0x"+E.toString(16).toUpperCase(),compressedSize:e(d),size:e(c),fileNameLength:e(f),extraLength:e(I),commentLength:e(N),diskNumStart:D,inAttr:m,attr:C,offset:L,centralHeaderSize:e(i.CENHDR+f+I+N)}},toString:function(){return JSON.stringify(this.toJSON(),null,"\t")}}}},{"../util":14}],3:[function(e,t,n){n.EntryHeader=e("./entryHeader"),n.MainHeader=e("./mainHeader")},{"./entryHeader":2,"./mainHeader":4}],4:[function(e,t){var n=e("../util"),r=n.Constants;t.exports=function(){var e=0,t=0,i=0,a=0,s=0;return{get diskEntries(){return e},set diskEntries(n){e=t=n},get totalEntries(){return t},set totalEntries(n){t=e=n},get size(){return i},set size(e){i=e},get offset(){return a},set offset(e){a=e},get commentLength(){return s},set commentLength(e){s=e},get mainHeaderSize(){return r.ENDHDR+s},loadFromBinary:function(o){if((o.length!==r.ENDHDR||o.readUInt32LE(0)!==r.ENDSIG)&&(o.length<r.ZIP64HDR||o.readUInt32LE(0)!==r.ZIP64SIG))throw new Error(n.Errors.INVALID_END);o.readUInt32LE(0)===r.ENDSIG?(e=o.readUInt16LE(r.ENDSUB),t=o.readUInt16LE(r.ENDTOT),i=o.readUInt32LE(r.ENDSIZ),a=o.readUInt32LE(r.ENDOFF),s=o.readUInt16LE(r.ENDCOM)):(e=n.readBigUInt64LE(o,r.ZIP64SUB),t=n.readBigUInt64LE(o,r.ZIP64TOT),i=n.readBigUInt64LE(o,r.ZIP64SIZE),a=n.readBigUInt64LE(o,r.ZIP64OFF),s=0)},toBinary:function(){var n=Buffer.alloc(r.ENDHDR+s);return n.writeUInt32LE(r.ENDSIG,0),n.writeUInt32LE(0,4),n.writeUInt16LE(e,r.ENDSUB),n.writeUInt16LE(t,r.ENDTOT),n.writeUInt32LE(i,r.ENDSIZ),n.writeUInt32LE(a,r.ENDOFF),n.writeUInt16LE(s,r.ENDCOM),n.fill(" ",r.ENDHDR),n},toJSON:function(){return{diskEntries:e,totalEntries:t,size:i+" bytes",offset:function(e,t){let n=e.toString(16).toUpperCase();for(;n.length<t;)n="0"+n;return"0x"+n}(a,4),commentLength:s}},toString:function(){return JSON.stringify(this.toJSON(),null,"\t")}}}},{"../util":14}],5:[function(e,t){t.exports=function(t){var n=e("zlib"),r={chunkSize:1024*(parseInt(t.length/1024)+1)};return{deflate:function(){return n.deflateRawSync(t,r)},deflateAsync:function(e){var i=n.createDeflateRaw(r),a=[],s=0;i.on("data",function(e){a.push(e),s+=e.length}),i.on("end",function(){var t=Buffer.alloc(s),n=0;t.fill(0);for(var r,o=0;o<a.length;o++)r=a[o],r.copy(t,n),n+=r.length;e&&e(t)}),i.end(t)}}}},{zlib:void 0}],6:[function(e,t,n){n.Deflater=e("./deflater"),n.Inflater=e("./inflater"),n.ZipCrypto=e("./zipcrypto")},{"./deflater":5,"./inflater":7,"./zipcrypto":8}],7:[function(e,t){const n=+(process.versions?process.versions.node:"").split(".")[0]||0;t.exports=function(t,r){var i=e("zlib");const a=15<=n&&0<r?{maxOutputLength:r}:{};return{inflate:function(){return i.inflateRawSync(t,a)},inflateAsync:function(e){var n=i.createInflateRaw(a),r=[],s=0;n.on("data",function(e){r.push(e),s+=e.length}),n.on("end",function(){var t=Buffer.alloc(s),n=0;t.fill(0);for(var a,o=0;o<r.length;o++)a=r[o],a.copy(t,n),n+=a.length;e&&e(t)}),n.end(t)}}}},{zlib:void 0}],8:[function(e,t){"use strict";function n(e){const t=Buffer.isBuffer(e)?e:Buffer.from(e);this.keys=new Uint32Array([305419896,591751049,878082192]);for(let n=0;n<t.length;n++)this.updateKeys(t[n])}function r(e){const t=new n(e);return function(e){const n=Buffer.alloc(e.length);let r=0;for(let i of e)n[r++]=t.updateKeys(i^t.next());return n}}function i(e){const t=new n(e);return function(e,n,r=0){n||(n=Buffer.alloc(e.length));for(let i of e){const e=t.next();n[r++]=i^e,t.updateKeys(i)}return n}}const{randomFillSync:a}=e("crypto"),s=new Uint32Array(256).map((e,t)=>{for(let n=0;8>n;n++)0==(1&t)?t>>>=1:t=3988292384^t>>>1;return t>>>0}),o=(e,t)=>Math.imul(e,t)>>>0,l=(e,t)=>s[255&(e^t)]^e>>>8,E=()=>"function"==typeof a?a(Buffer.alloc(12)):E.node();E.node=()=>{const e=Buffer.alloc(12),t=e.length;for(let n=0;n<t;n++)e[n]=255&256*Math.random();return e};const d={genSalt:E};n.prototype.updateKeys=function(e){const t=this.keys;return t[0]=l(t[0],e),t[1]+=255&t[0],t[1]=o(t[1],134775813)+1,t[2]=l(t[2],t[1]>>>24),e},n.prototype.next=function(){const e=(2|this.keys[2])>>>0;return 255&o(e,1^e)>>8},t.exports={decrypt:function(e,t,n){if(!e||!Buffer.isBuffer(e)||12>e.length)return Buffer.alloc(0);const i=r(n),a=i(e.slice(0,12)),s=8==(8&t.flags)?t.timeHighByte:t.crc>>>24;if(a[11]!==s)throw"ADM-ZIP: Wrong Password";return i(e.slice(12))},encrypt:function(e,t,n,r=!1){null==e&&(e=Buffer.alloc(0)),Buffer.isBuffer(e)||(e=Buffer.from(e.toString()));const a=i(n),s=d.genSalt();s[11]=255&t.crc>>>24,r&&(s[10]=255&t.crc>>>16);const o=Buffer.alloc(e.length+12);return a(s,o),a(e,o,12)},_salter:function(e){d.genSalt=Buffer.isBuffer(e)&&12<=e.length?function(){return e.slice(0,12)}:"node"===e?E.node:E}}},{crypto:void 0}],9:[function(e,t){"use strict";t.exports=e("fs")},{fs:void 0}],10:[function(e,t){t.exports={LOCHDR:30,LOCSIG:67324752,LOCVER:4,LOCFLG:6,LOCHOW:8,LOCTIM:10,LOCCRC:14,LOCSIZ:18,LOCLEN:22,LOCNAM:26,LOCEXT:28,EXTSIG:134695760,EXTHDR:16,EXTCRC:4,EXTSIZ:8,EXTLEN:12,CENHDR:46,CENSIG:33639248,CENVEM:4,CENVER:6,CENFLG:8,CENHOW:10,CENTIM:12,CENCRC:16,CENSIZ:20,CENLEN:24,CENNAM:28,CENEXT:30,CENCOM:32,CENDSK:34,CENATT:36,CENATX:38,CENOFF:42,ENDHDR:22,ENDSIG:101010256,ENDSUB:8,ENDTOT:10,ENDSIZ:12,ENDOFF:16,ENDCOM:20,END64HDR:20,END64SIG:117853008,END64START:4,END64OFF:8,END64NUMDISKS:16,ZIP64SIG:101075792,ZIP64HDR:56,ZIP64LEAD:12,ZIP64SIZE:4,ZIP64VEM:12,ZIP64VER:14,ZIP64DSK:16,ZIP64DSKDIR:20,ZIP64SUB:24,ZIP64TOT:32,ZIP64SIZB:40,ZIP64OFF:48,ZIP64EXTRA:56,STORED:0,SHRUNK:1,REDUCED1:2,REDUCED2:3,REDUCED3:4,REDUCED4:5,IMPLODED:6,DEFLATED:8,ENHANCED_DEFLATED:9,PKWARE:10,BZIP2:12,LZMA:14,IBM_TERSE:18,IBM_LZ77:19,AES_ENCRYPT:99,FLG_ENC:1,FLG_COMP1:2,FLG_COMP2:4,FLG_DESC:8,FLG_ENH:16,FLG_PATCH:32,FLG_STR:64,FLG_EFS:2048,FLG_MSK:4096,FILE:2,BUFFER:1,NONE:0,EF_ID:0,EF_SIZE:2,ID_ZIP64:1,ID_AVINFO:7,ID_PFS:8,ID_OS2:9,ID_NTFS:10,ID_OPENVMS:12,ID_UNIX:13,ID_FORK:14,ID_PATCH:15,ID_X509_PKCS7:20,ID_X509_CERTID_F:21,ID_X509_CERTID_C:22,ID_STRONGENC:23,ID_RECORD_MGT:24,ID_X509_PKCS7_RL:25,ID_IBM1:101,ID_IBM2:102,ID_POSZIP:18064,EF_ZIP64_OR_32:4294967295,EF_ZIP64_OR_16:65535,EF_ZIP64_SUNCOMP:0,EF_ZIP64_SCOMP:8,EF_ZIP64_RHO:16,EF_ZIP64_DSN:24}},{}],11:[function(e,t){t.exports={INVALID_LOC:"Invalid LOC header (bad signature)",INVALID_CEN:"Invalid CEN header (bad signature)",INVALID_END:"Invalid END header (bad signature)",NO_DATA:"Nothing to decompress",BAD_CRC:"CRC32 checksum failed",FILE_IN_THE_WAY:"There is a file in the way: %s",UNKNOWN_METHOD:"Invalid/unsupported compression method",AVAIL_DATA:"inflate::Available inflate data did not terminate",INVALID_DISTANCE:"inflate::Invalid literal/length or distance code in fixed or dynamic block",TO_MANY_CODES:"inflate::Dynamic block code description: too many length or distance codes",INVALID_REPEAT_LEN:"inflate::Dynamic block code description: repeat more than specified lengths",INVALID_REPEAT_FIRST:"inflate::Dynamic block code description: repeat lengths with no first length",INCOMPLETE_CODES:"inflate::Dynamic block code description: code lengths codes incomplete",INVALID_DYN_DISTANCE:"inflate::Dynamic block code description: invalid distance code lengths",INVALID_CODES_LEN:"inflate::Dynamic block code description: invalid literal/length code lengths",INVALID_STORE_BLOCK:"inflate::Stored block length did not match one's complement",INVALID_BLOCK_TYPE:"inflate::Invalid block type (type == 3)",CANT_EXTRACT_FILE:"Could not extract the file",CANT_OVERRIDE:"Target file already exists",DISK_ENTRY_TOO_LARGE:"Number of disk entries is too large",NO_ZIP:"No zip file was loaded",NO_ENTRY:"Entry doesn't exist",DIRECTORY_CONTENT_ERROR:"A directory cannot have content",FILE_NOT_FOUND:"File not found: %s",NOT_IMPLEMENTED:"Not implemented",INVALID_FILENAME:"Invalid filename",INVALID_FORMAT:"Invalid or unsupported zip format. No END header found"}},{}],12:[function(e,t){const n=e("./fileSystem").require(),r=e("path");n.existsSync=n.existsSync||r.existsSync,t.exports=function(e){var t=e||"",i=function(){return{directory:!1,readonly:!1,hidden:!1,executable:!1,mtime:0,atime:0}}(),a=null;return t&&n.existsSync(t)?(a=n.statSync(t),i.directory=a.isDirectory(),i.mtime=a.mtime,i.atime=a.atime,i.executable=0!=(73&a.mode),i.readonly=0==(128&a.mode),i.hidden="."===r.basename(t)[0]):console.warn("Invalid path: "+t),{get directory(){return i.directory},get readOnly(){return i.readonly},get hidden(){return i.hidden},get mtime(){return i.mtime},get atime(){return i.atime},get executable(){return i.executable},decodeAttributes:function(){},encodeAttributes:function(){},toJSON:function(){return{path:t,isDirectory:i.directory,isReadOnly:i.readonly,isHidden:i.hidden,isExecutable:i.executable,mTime:i.mtime,aTime:i.atime}},toString:function(){return JSON.stringify(this.toJSON(),null,"\t")}}}},{"./fileSystem":13,path:void 0}],13:[function(e,t,n){n.require=function(){if("object"==typeof process&&process.versions&&process.versions.electron)try{const t=e("original-fs");if(0<Object.keys(t).length)return t}catch(t){}return e("fs")}},{fs:void 0,"original-fs":9}],14:[function(e,t){t.exports=e("./utils"),t.exports.Constants=e("./constants"),t.exports.Errors=e("./errors"),t.exports.FileAttr=e("./fattr")},{"./constants":10,"./errors":11,"./fattr":12,"./utils":15}],15:[function(e,t){function n(e){this.sep=a.sep,this.fs=r,E(e)&&E(e.fs)&&"function"==typeof e.fs.statSync&&(this.fs=e.fs)}const r=e("./fileSystem").require(),a=e("path"),s=e("./constants"),o=e("./errors"),l="object"==typeof process&&"win32"===process.platform,E=e=>e&&"object"==typeof e,d=new Uint32Array(256).map((e,t)=>{for(let n=0;8>n;n++)0==(1&t)?t>>>=1:t=3988292384^t>>>1;return t>>>0});t.exports=n,n.prototype.makeDir=function(e){const t=this;(function(e){let n=e.split(t.sep)[0];e.split(t.sep).forEach(function(e){if(e&&":"!==e.substr(-1,1)){n+=t.sep+e;var r;try{r=t.fs.statSync(n)}catch(r){t.fs.mkdirSync(n)}if(r&&r.isFile())throw o.FILE_IN_THE_WAY.replace("%s",n)}})})(e)},n.prototype.writeFileTo=function(t,n,r,i){const s=this;if(s.fs.existsSync(t)){if(!r)return!1;var o=s.fs.statSync(t);if(o.isDirectory())return!1}var l=a.dirname(t);s.fs.existsSync(l)||s.makeDir(l);var E;try{E=s.fs.openSync(t,"w",438)}catch(n){s.fs.chmodSync(t,438),E=s.fs.openSync(t,"w",438)}if(E)try{s.fs.writeSync(E,n,0,n.length,0)}finally{s.fs.closeSync(E)}return s.fs.chmodSync(t,i||438),!0},n.prototype.writeFileToAsync=function(e,t,n,r,i){"function"==typeof r&&(i=r,r=void 0);const s=this;s.fs.exists(e,function(o){return o&&!n?i(!1):void s.fs.stat(e,function(n,l){if(o&&l.isDirectory())return i(!1);var E=a.dirname(e);s.fs.exists(E,function(n){n||s.makeDir(E),s.fs.open(e,"w",438,function(n,a){n?s.fs.chmod(e,438,function(){s.fs.open(e,"w",438,function(n,a){s.fs.write(a,t,0,t.length,0,function(){s.fs.close(a,function(){s.fs.chmod(e,r||438,function(){i(!0)})})})})}):a?s.fs.write(a,t,0,t.length,0,function(){s.fs.close(a,function(){s.fs.chmod(e,r||438,function(){i(!0)})})}):s.fs.chmod(e,r||438,function(){i(!0)})})})})})},n.prototype.findFiles=function(e){function t(e,r,i){"boolean"==typeof r&&(i=r,r=void 0);let s=[];return n.fs.readdirSync(e).forEach(function(o){var l=a.join(e,o);n.fs.statSync(l).isDirectory()&&i&&(s=s.concat(t(l,r,i))),(!r||r.test(l))&&s.push(a.normalize(l)+(n.fs.statSync(l).isDirectory()?n.sep:""))}),s}const n=this;return t(e,void 0,!0)},n.prototype.getAttributes=function(){},n.prototype.setAttributes=function(){},n.crc32update=function(e,t){return d[255&(e^t)]^e>>>8},n.crc32=function(e){"string"==typeof e&&(e=Buffer.from(e,"utf8")),d.length||genCRCTable();let t=e.length,r=-1;for(let i=0;i<t;)r=n.crc32update(r,e[i++]);return~r>>>0},n.methodToString=function(e){return e===s.STORED?"STORED ("+e+")":e===s.DEFLATED?"DEFLATED ("+e+")":"UNSUPPORTED ("+e+")"},n.canonical=function(e){if(!e)return"";var t=a.posix.normalize("/"+e.split("\\").join("/"));return a.join(".",t)},n.sanitize=function(e,t){e=a.resolve(a.normalize(e));for(var n,r=t.split("/"),s=0,o=r.length;s<o;s++)if(n=a.normalize(a.join(e,r.slice(s,o).join(a.sep))),0===n.indexOf(e))return n;return a.normalize(a.join(e,a.basename(t)))},n.toBuffer=function(e){return Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e):"string"==typeof e?Buffer.from(e,"utf8"):Buffer.alloc(0)},n.readBigUInt64LE=function(e,t){var n=Buffer.from(e.slice(t,t+8));return n.swap64(),parseInt(`0x${n.toString("hex")}`)},n.isWin=l,n.crcTable=d},{"./constants":10,"./errors":11,"./fileSystem":13,path:void 0}],16:[function(e,t){var n=e("./util"),r=e("./headers"),i=n.Constants,a=e("./methods");t.exports=function(e){function t(){return e&&e instanceof Uint8Array?(f.loadLocalHeaderFromBinary(e),e.slice(f.realDataOffset,f.realDataOffset+f.compressedSize)):Buffer.alloc(0)}function s(e){if(!(8!=(8&f.flags)));else if(n.crc32(e)!==f.localHeader.crc)return!1;return!0}function o(e,r,i){if("undefined"==typeof r&&"string"==typeof e&&(i=e,e=void 0),D)return e&&r&&r(Buffer.alloc(0),n.Errors.DIRECTORY_CONTENT_ERROR),Buffer.alloc(0);var o=t();if(0===o.length)return e&&r&&r(o),o;if(f.encrypted){if("string"!=typeof i&&!Buffer.isBuffer(i))throw new Error("ADM-ZIP: Incompatible password parameter");o=a.ZipCrypto.decrypt(o,f,i)}var l=Buffer.alloc(f.size);switch(f.method){case n.Constants.STORED:if(o.copy(l),!s(l))throw e&&r&&r(l,n.Errors.BAD_CRC),new Error(n.Errors.BAD_CRC);else return e&&r&&r(l),l;case n.Constants.DEFLATED:var E=new a.Inflater(o,f.size);if(!e){const e=E.inflate(l);if(e.copy(l,0),!s(l))throw new Error(n.Errors.BAD_CRC+" "+I.toString());return l}E.inflateAsync(function(e){e.copy(e,0),r&&(s(e)?r(e):r(e,n.Errors.BAD_CRC))});break;default:throw e&&r&&r(Buffer.alloc(0),n.Errors.UNKNOWN_METHOD),new Error(n.Errors.UNKNOWN_METHOD)}}function l(r,i){if((!m||!m.length)&&Buffer.isBuffer(e))return r&&i&&i(t()),t();if(m.length&&!D){var s;switch(f.method){case n.Constants.STORED:return f.compressedSize=f.size,s=Buffer.alloc(m.length),m.copy(s),r&&i&&i(s),s;default:case n.Constants.DEFLATED:var o=new a.Deflater(m);if(!r){var l=o.deflate();return f.compressedSize=l.length,l}o.deflateAsync(function(e){s=Buffer.alloc(e.length),f.compressedSize=e.length,e.copy(s),i&&i(s)}),o=null}}else if(r&&i)i(Buffer.alloc(0));else return Buffer.alloc(0)}function E(e,t){return(e.readUInt32LE(t+4)<<4)+e.readUInt32LE(t)}function d(e){for(var t,n,r,a=0;a<e.length;)t=e.readUInt16LE(a),a+=2,n=e.readUInt16LE(a),a+=2,r=e.slice(a,a+n),a+=n,i.ID_ZIP64===t&&c(r)}function c(e){var t,n,r,a;e.length>=i.EF_ZIP64_SCOMP&&(t=E(e,i.EF_ZIP64_SUNCOMP),f.size===i.EF_ZIP64_OR_32&&(f.size=t)),e.length>=i.EF_ZIP64_RHO&&(n=E(e,i.EF_ZIP64_SCOMP),f.compressedSize===i.EF_ZIP64_OR_32&&(f.compressedSize=n)),e.length>=i.EF_ZIP64_DSN&&(r=E(e,i.EF_ZIP64_RHO),f.offset===i.EF_ZIP64_OR_32&&(f.offset=r)),e.length>=i.EF_ZIP64_DSN+4&&(a=e.readUInt32LE(i.EF_ZIP64_DSN),f.diskNumStart===i.EF_ZIP64_OR_16&&(f.diskNumStart=a))}var f=new r.EntryHeader,I=Buffer.alloc(0),N=Buffer.alloc(0),D=!1,m=null,C=Buffer.alloc(0);return{get entryName(){return I.toString()},get rawEntryName(){return I},set entryName(e){I=n.toBuffer(e);var t=I[I.length-1];D=47===t||92===t,f.fileNameLength=I.length},get extra(){return C},set extra(e){C=e,f.extraLength=e.length,d(e)},get comment(){return N.toString()},set comment(e){N=n.toBuffer(e),f.commentLength=N.length},get name(){var e=I.toString();return D?e.substr(e.length-1).split("/").pop():e.split("/").pop()},get isDirectory(){return D},getCompressedData:function(){return l(!1,null)},getCompressedDataAsync:function(e){l(!0,e)},setData:function(e){m=n.toBuffer(e),!D&&m.length?(f.size=m.length,f.method=n.Constants.DEFLATED,f.crc=n.crc32(e),f.changed=!0):f.method=n.Constants.STORED},getData:function(e){return f.changed?m:o(!1,null,e)},getDataAsync:function(e,t){f.changed?e(m):o(!0,e,t)},set attr(e){f.attr=e},get attr(){return f.attr},set header(e){f.loadFromBinary(e)},get header(){return f},packCentralHeader:function(){var e=f.centralHeaderToBinary(),t=n.Constants.CENHDR;return I.copy(e,t),t+=I.length,f.extraLength&&(C.copy(e,t),t+=f.extraLength),f.commentLength&&N.copy(e,t),e},packLocalHeader:function(){let e=0;const t=f.localHeaderToBinary(),n=Buffer.alloc(t.length+I.length+C.length);return t.copy(n,e),e+=t.length,I.copy(n,e),e+=I.length,C.copy(n,e),e+=C.length,n},toJSON:function(){const t=function(e){return"<"+(e&&e.length+" bytes buffer"||"null")+">"};return{entryName:this.entryName,name:this.name,comment:this.comment,isDirectory:this.isDirectory,header:f.toJSON(),compressedData:t(e),data:t(m)}},toString:function(){return JSON.stringify(this.toJSON(),null,"\t")}}}},{"./headers":3,"./methods":6,"./util":14}],17:[function(e,t){var r=Math.max;const a=e("./zipEntry"),s=e("./headers"),o=e("./util");t.exports=function(e,t){function n(t){const n=I.diskEntries;let r=I.offset;for(let s,l=0;l<n;l++){s=r;const n=new a(e);n.header=e.slice(s,s+=o.Constants.CENHDR),n.entryName=e.slice(s,s+=n.header.fileNameLength),r+=n.header.centralHeaderSize,t(n)}}function l(){if(N=!0,c={},I.diskEntries>(e.length-I.offset)/o.Constants.CENHDR)throw new Error(o.Errors.DISK_ENTRY_TOO_LARGE);d=Array(I.diskEntries);for(var t=I.offset,n=0;n<d.length;n++){var r=t,s=new a(e);s.header=e.slice(r,r+=o.Constants.CENHDR),s.entryName=e.slice(r,r+=s.header.fileNameLength),s.header.extraLength&&(s.extra=e.slice(r,r+=s.header.extraLength)),s.header.commentLength&&(s.comment=e.slice(r,r+s.header.commentLength)),t+=s.header.centralHeaderSize,d[n]=s,c[s.entryName]=s}}function E(){1<d.length&&!m&&d.sort((e,t)=>e.entryName.toLowerCase().localeCompare(t.entryName.toLowerCase()))}var d=[],c={},f=Buffer.alloc(0),I=new s.MainHeader,N=!1;const D=Object.assign(Object.create(null),t),{noSort:m}=D;return e?function(t){var a=e.length-o.Constants.ENDHDR,s=r(0,a-65535),E=s,d=e.length,c=-1,N=0;for(a;a>=E;a--)if(80===e[a]){if(e.readUInt32LE(a)===o.Constants.ENDSIG){c=a,N=a,d=a+o.Constants.ENDHDR,E=a-o.Constants.END64HDR;continue}if(e.readUInt32LE(a)===o.Constants.END64SIG){E=s;continue}if(e.readUInt32LE(a)===o.Constants.ZIP64SIG){c=a,d=a+o.readBigUInt64LE(e,a+o.Constants.ZIP64SIZE)+o.Constants.ZIP64LEAD;break}}if(!~c)throw new Error(o.Errors.INVALID_FORMAT);I.loadFromBinary(e.slice(c,d)),I.commentLength&&(f=e.slice(N+o.Constants.ENDHDR)),t&&l()}(D.readEntries):N=!0,{get entries(){return N||l(),d},get comment(){return f.toString()},set comment(e){f=o.toBuffer(e),I.commentLength=f.length},getEntryCount:function(){return N?d.length:I.diskEntries},forEach:function(e){return N?void d.forEach(e):void n(e)},getEntry:function(e){return N||l(),c[e]||null},setEntry:function(e){N||l(),d.push(e),c[e.entryName]=e,I.totalEntries=d.length},deleteEntry:function(e){N||l();var t=c[e];if(t&&t.isDirectory){this.getEntryChildren(t).forEach(function(t){t.entryName!==e&&this.deleteEntry(t.entryName)})}d.splice(d.indexOf(t),1),delete c[e],I.totalEntries=d.length},getEntryChildren:function(e){if(N||l(),e&&e.isDirectory){const t=[],n=e.entryName,r=n.length;return d.forEach(function(e){e.entryName.substr(0,r)===n&&t.push(e)}),t}return[]},compressToBuffer:function(){N||l(),E();const e=[],t=[];let n=0,r=0;I.size=0,I.offset=0;for(const i of d){const a=i.getCompressedData();i.header.offset=r;const s=i.packLocalHeader(),o=s.length+a.length;r+=o,e.push(s),e.push(a);const l=i.packCentralHeader();t.push(l),I.size+=l.length,n+=o+l.length}n+=I.mainHeaderSize,I.offset=r,r=0;const i=Buffer.alloc(n);for(const t of e)t.copy(i,r),r+=t.length;for(const e of t)e.copy(i,r),r+=e.length;const a=I.toBinary();return f&&f.copy(a,o.Constants.ENDHDR),a.copy(i,r),i},toAsyncBuffer:function(e,t,n,r){try{N||l(),E();const t=[],i=[];let a=0,s=0;I.size=0,I.offset=0;const c=function(l){if(0<l.length){const e=l.shift(),o=e.entryName+e.extra.toString();n&&n(o),e.getCompressedDataAsync(function(n){r&&r(o),e.header.offset=s;const E=e.packLocalHeader(),d=E.length+n.length;s+=d,t.push(E),t.push(n);const f=e.packCentralHeader();i.push(f),I.size+=f.length,a+=d+f.length,c(l)})}else{a+=I.mainHeaderSize,I.offset=s,s=0;const n=Buffer.alloc(a);t.forEach(function(e){e.copy(n,s),s+=e.length}),i.forEach(function(e){e.copy(n,s),s+=e.length});const r=I.toBinary();f&&f.copy(r,o.Constants.ENDHDR),r.copy(n,s),e(n)}};c(Array.from(d))}catch(n){t(n)}}}}},{"./headers":3,"./util":14,"./zipEntry":16}],18:[function(e){global.AdmZip=e("adm-zip")},{"adm-zip":1}]},{},[18]);}
}

const fs = require('node:fs'),
    path = require('node:path'),
    { exec } = require('node:child_process'),
    isWinOs = process.platform === 'win32',
    cwd = process.cwd();

    knownOpts = {
        include: [path, Array]
    },
    shortHands = {
        i: ['--include']
    },
    // everything is optional.
    // knownOpts and shorthands default to {}
    // arg list defaults to process.argv
    // slice defaults to 2
    parsed = nopt(knownOpts, shortHands, process.argv, 2);

let inputName, outputName;
if (parsed.argv.remain.length >= 1)
{
    inputName = path.normalize(parsed.argv.remain[0]);
    const inputPath = path.parse(inputName);
    if (inputPath.ext === '')
    {
        inputName = path.format(Object.assign({}, inputPath, {ext:'.js',base:undefined}));
    }
}
else
{
    console.log('Syntax: makeSea  [-i asset1_path -i asset2_path] <input.js> [output.exe]');
    process.exit(1);
}
if (parsed.argv.remain.length >= 2)
{
    outputName = path.normalize(parsed.argv.remain[1]);
    if (isWinOs)
    {
        outputName = path.parse(outputName).name;
    }
    outputName = {name: outputName};
}

//0. Make sure npm & postject are available
function exists(path)
{
    return (fs.statSync(path, { throwIfNoEntry: false }) !== undefined);
}

const sea = require('node:sea');
if (sea.isSea())
{
    const pathNm = path.resolve(__dirname + `${path.sep}node_modules`) + path.sep,
        pathNpm = `${pathNm}npm`,
        pathPostject = `${pathNm}postject`,
        pathNode = path.resolve(__dirname + `${path.sep}node${isWinOs?'.exe':''}`);

    if (!exists(pathNode))
    {
        const asset = Buffer.from(sea.getAsset('node.zip')),
            zip = new AdmZip(asset);
        console.log('Extracting node executable...'.bold.warn);
        zip.extractAllTo(__dirname);
        console.log('Extracting node executable...done =)'.bold.info);
    }
    if (!exists(pathNpm) || !exists(pathPostject))
    {
        const asset = Buffer.from(sea.getAsset('node_modules.zip')),
            zip = new AdmZip(asset);
        console.log('Extracting node_modules folder...'.bold.warn);
        zip.extractAllTo(__dirname);
        console.log('Extracting node_modules folder...done =)'.bold.info);
    }
}

let inputPath = path.parse(inputName);
//path.format: must eliminate 'base' to let 'name'+'ext' take effect!
const jsonPath = path.format(Object.assign({}, inputPath, {ext:'.seaconfig.json',base:undefined}));
const blobPath = path.format(Object.assign({}, inputPath, {ext:'.blob',base:undefined}));
const exePath = path.format(Object.assign({}, inputPath, outputName, {ext:'.exe',base:undefined}));

//1. Generate SEApp's config.json
console.log('1. Generating config...');
const seaConfigContent = {
    main: `${inputName.replaceAll('\\','/')}`,
    output: `${blobPath.replaceAll('\\','/')}`
};
if (parsed.include && (parsed.include.length > 0))
{
    const assets = parsed.include.reduce((a, v) => { const basename=path.basename(v); return { ...a, [basename]: v}; }, {});
    Object.assign(seaConfigContent, {assets});
}
//console.log(seaConfigContent);
fs.writeFile(jsonPath, JSON.stringify(seaConfigContent), { encoding: 'utf8' }, (err) => {
    if (err) {
        console.log('ERR: Failed to generate config,'.bold.error, jsonPath, 'owing to', err);
        process.exit(1);
    }
    console.log('1. Generating config...done:'.bold.info, jsonPath);
    genBlob();
});

function genBlob()
{
    console.log('2. Generating blob...');
    const cmdline = `node --experimental-sea-config ${jsonPath}`;
    //console.log('full cmd'.bold.debug, cmdline);
    exec(cmdline,
        { cwd }, (err /*, stdout, stderr*/) => {
            if (err)
            {
                console.log('ERR: Failed to generate blob,'.bold.error, blobPath, 'owing to', err);
                process.exit(1);
            }
            console.log('2. Generating blob...done:'.bold.info, blobPath);
            copyNode();
        });
}

function copyNode()
{
    fs.stat(exePath, (err, stat) => {
        if (!err && stat && stat.isFile())
        {
            //file exists
            console.log('3. Skip copying node as already exists:'.bold.warn, exePath);
            genSea();
            return;
        }
        console.log('3. Making copy of node...');
        fs.copyFile(isWinOs? 'node.exe': 'node', exePath, fs.constants.COPYFILE_EXCL, (err) => {
            if (err) {
                console.log('ERR: Failed to copy node to'.bold.error, exePath, 'owing to', err);
                process.exit(1);
            }
            console.log('3. Copying node...done.'.bold.info);
            genSea();
        });
    });
}

//PART 4 TEST ONLY - omit this part in final makeSea
console.log('You should get a warning that genSea() does not exist!'.bold.warn);
console.log('  along with the .blob'.bold.warn);
